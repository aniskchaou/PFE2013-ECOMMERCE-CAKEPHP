<?phpclass MediasController extends AppController{function admin_index($prop_id){if($this->request->is('post')){$data=$this->request->data;//nom de fichier$dir=IMAGES.date('Y');//si le fichier n'existe pasif(!file_exists($dir))mkdir($dir,0777);$dir .=DS.date('m');if(!file_exists($dir))mkdir($dir,0777);$f=explode('.',$data['Media']['file']['name']);$ext='.'.end($f);$filename=Inflector::slug(implode('.',array_slice($f,0,-1)),'-');//suvegrage$success=$this->Media->save(array('name'=>$data['Media']['name'],'url'=>date('Y').'/'.date('m').'/'.$filename.$ext,'source_id'=>$prop_id));if($success){move_uploaded_file($data['Media']['file']['tmp_name'],$dir.DS.$filename.$ext);}else{}}$media=$this->Media->find('all',array('conditions'=>array('source_id'=>$prop_id)));$this->set('medias',$media);}function admin_menu(){}function admin_delete($id){$this->Media->id=$id;$file=$this->Media->field('url');unlink(IMAGES.DS.$file);$this->Media->delete($id);$this->Session->seFlash("images a ete supprimer","notif");$this->redirect($this->referer());}function image(){$medias=$this->Media->find('all');return $medias;}}?>